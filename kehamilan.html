<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kehamilan - Lullaby.eca</title>
    <style>
        /* CSS DASAR - TEMA BABY BLUE */
        body { font-family: 'Segoe UI', Arial, sans-serif; line-height: 1.6; margin: 0; padding: 0; color: #333; background-color: #f0f8ff; }
        header { background: #5da9e9; color: white; padding: 1.5rem; text-align: center; }
        
        /* Navigasi Responsif */
        nav { background: #4a90e2; padding: 0.8rem; text-align: center; position: sticky; top: 0; z-index: 1000; }
        nav a { color: white; margin: 0 8px; text-decoration: none; font-weight: bold; font-size: 0.85rem; display: inline-block; padding: 5px 0; }
        
        .container { padding: 15px; max-width: 900px; margin: auto; }
        .card { border: none; padding: 20px; border-radius: 15px; margin-bottom: 20px; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        h2 { color: #2c5282; border-left: 5px solid #5da9e9; padding-left: 10px; margin-top: 0; margin-bottom: 15px; font-size: 1.3rem; }
        
        /* Grid System Responsif */
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
            gap: 12px; 
            margin-top: 15px; 
        }
        
        .grid-item { text-align: center; padding: 12px; border: 1px solid #e1effe; border-radius: 12px; background: #fff; transition: 0.3s; }
        .grid-item img { width: 45px; height: 45px; margin-bottom: 8px; }
        .grid-item b { display: block; color: #4a90e2; font-size: 0.8rem; margin-bottom: 3px; }
        .grid-item p { font-size: 0.75rem; margin: 0; color: #555; line-height: 1.2; }

        .danger-text { color: #e53e3e; font-weight: bold; font-size: 0.9rem; }
        
        /* Tabel Responsif */
        .table-wrapper { overflow-x: auto; } 
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; border-radius: 10px; overflow: hidden; min-width: 400px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #e1effe; font-size: 0.85rem; }
        th { background-color: #5da9e9; color: white; }
        
        footer { text-align: center; padding: 20px; background: #2c5282; color: white; margin-top: 30px; font-size: 0.8rem; }

        /* ATURAN KHUSUS UNTUK HP */
        @media (max-width: 600px) {
            header h1 { font-size: 1.5rem; }
            header p { font-size: 0.9rem; }
            nav a { margin: 0 5px; font-size: 0.75rem; }
            .grid-container { grid-template-columns: repeat(2, 1fr); }
            .card { padding: 15px; }
            h2 { font-size: 1.1rem; }
        }

        /* Gaya Fitur Interaktif */
        .btn { background: #4a90e2; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; width: 100%; }
        .result-box { margin-top: 15px; padding: 15px; border-radius: 10px; display: none; font-weight: bold; font-size: 0.85rem; }
        .normal { background: #e6fffa; color: #234e52; border: 1px solid #b2f5ea; }
        .warning { background: #fff5f5; color: #822727; border: 1px solid #feb2b2; }
        input[type="number"], input[type="text"], select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #cbd5e0; border-radius: 5px; box-sizing: border-box; }
        .check-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f0f4f8; font-size: 0.85rem; }
    </style>
</head>
<body>

<header>
    <h1>Masa Kehamilan</h1>
    <p>Pemantauan Kesehatan Ibu & Janin bersama Lullaby.eca</p>
</header>

<nav>
    <a href="index.html">Beranda</a>
    <a href="kehamilan.html">Kehamilan</a>
    <a href="persalinan.html">Persalinan</a>
    <a href="nifas.html">Nifas</a>
    <a href="bbl.html">Bayi Baru Lahir</a>
    <a href="KB.html">KB</a>
    <a href="jurnal.html">Jurnal Kesehatan</a>
    <a href="tanya ibu.html">Lulleca AI</a>
	 <a href="gizi.html">Lulleca Gizi</a>
</nav>

<div class="container">
    <div class="card">
        <h2>Jadwal Kunjungan Trimester III</h2>
        <p style="font-size: 0.9rem;">Sesuai standar terbaru, dilakukan minimal 3 kali kunjungan pada trimester ketiga:</p>
        <div class="table-wrapper">
            <table>
                <tr>
                    <th>Kunjungan</th>
                    <th>Waktu</th>
                    <th>Fokus Pemeriksaan</th>
                </tr>
                <tr>
                    <td>Kunjungan 4 (K4)</td>
                    <td>Trimester III</td>
                    <td>Oleh Bidan (Pemantauan rutin)</td>
                </tr>
                <tr>
                    <td>Kunjungan 5 (K5)</td>
                    <td>Trimester III</td>
                    <td>Wajib oleh Dokter + Skrining USG</td>
                </tr>
                <tr>
                    <td>Kunjungan 6 (K6)</td>
                    <td>Trimester III</td>
                    <td>Persiapan Persalinan</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="card">
        <h2>Standar Asuhan Kebidanan</h2>
        <div class="grid-container">
            <div class="grid-item"><img src="BB_kehamilan.PNG"><b>Timbang & Tinggi</b><p>Kenaikan ideal: 11-12 kg selama hamil.</p></div>
            <div class="grid-item"><img src="td_beranda.PNG"><b>Tekanan Darah</b><p>Normal: < 140/90 mmHg.</p></div>
            <div class="grid-item"><img src="lila_kehamilan.PNG"><b>Nilai LiLA</b><p>Batas Normal: ‚â• 23,5 cm.</p></div>
            <div class="grid-item"><img src="tfu_kehamilan.PNG"><b>Tinggi Fundus (TFU)</b><p>UK 38-40 mg: 33-37 cm.</p></div>
            <div class="grid-item"><img src="janin_kehamilan.PNG"><b>Janin & DJJ</b><p>Normal: 120-160 x/menit.</p></div>
            <div class="grid-item"><img src="imunisasi_kehamilan.PNG"><b>Imunisasi TT</b><p>Skrining hingga status TT 5.</p></div>
            <div class="grid-item"><img src="ttd_kehamilan.PNG"><b>Tablet Fe (TTD)</b><p>Minimal 90 tablet selama hamil.</p></div>
            <div class="grid-item"><img src="cekdarah_kehamilan.PNG"><b>Laboratorium</b><p>Cek Hb, Golda, & Triple Eliminasi.</p></div>
            <div class="grid-item"><img src="https://cdn-icons-png.flaticon.com/512/1142/1142172.png"><b>Tata Laksana</b><p>Penanganan kasus sesuai kewenangan.</p></div>
            <div class="grid-item"><img src="konseling_kehamilan.PNG"><b>Konseling (KIE)</b><p>Persiapan persalinan (P4K) & IMD.</p></div>
            <div class="grid-item"><img src="USG_kehamilan.PNG"><b>USG Dokter</b><p>Minimal 2x (TM I & TM III).</p></div>
            <div class="grid-item"><img src="mentalhealth_kehamilan.PNG"><b>Kesehatan Jiwa</b><p>Skrining psikologis ibu.</p></div>
        </div>
    </div>

    <div class="card" style="border-top: 5px solid #e53e3e;">
        <h2>Deteksi Dini: Tanda Bahaya</h2>
        <p class="danger-text">Segera hubungi Bidan jika mengalami salah satu hal di bawah ini:</p>
        <div class="grid-container">
            <div class="grid-item"><img src="sakitkepala_kehamilan.PNG"><p>Sakit Kepala Hebat / Pandangan Kabur</p></div>
            <div class="grid-item"><img src="edema_kehamilan.PNG"><p>Bengkak pada Muka & Tangan</p></div>
            <div class="grid-item"><img src="bleeding_kehamilan.PNG"><p>Perdarahan Jalan Lahir</p></div>
            <div class="grid-item"><img src="gerakanjanin_kehamialn.PNG"><p>Gerakan Janin Berkurang</p></div>
        </div>
    </div>

    <div class="card">
        <h2>Ketidaknyamanan Umum TM III</h2>
        <ul style="font-size: 0.9rem; padding-left: 20px;">
            <li><b>Sering Kencing:</b> Akibat tekanan kepala janin. Solusi: Kurangi minum saat malam sebelum tidur.</li>
            <li><b>Nyeri Punggung:</b> Akibat beban perut. Solusi: Gunakan sepatu datar & tidur miring kiri.</li>
            <li><b>Sulit Tidur:</b> Gunakan bantal penyangga & teknik relaksasi.</li>
        </ul>
    </div>

<div class="card">
        <h2>Kalkulator HPHT & HPL</h2>
        <label style="font-size: 0.85rem; font-weight: bold;">Hari Pertama Haid Terakhir (HPHT):</label>
        <input type="date" id="hphtInput" style="width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #cbd5e0; border-radius: 5px; box-sizing: border-box;">
        <button class="btn" onclick="hitungHPL()">Hitung Taksiran Persalinan</button>
        <div id="hasilHPL" class="result-box"></div>
    </div>
	
	<div class="card">
        <h2>Riwayat Pemeriksaan Rutin</h2>
        <div id="formPemeriksaan">
            <div class="grid-container" style="grid-template-columns: 1fr 1fr;">
                <input type="number" id="cekUK" placeholder="Usia Hamil (Minggu)">
                <input type="text" id="cekTensi" placeholder="Tensi (Contoh: 120/80)">
                <input type="number" id="cekBB" placeholder="Berat Badan (kg)">
                <input type="number" id="cekTFU" placeholder="Tinggi Fundus/TFU (cm)">
                <input type="number" id="cekDJJ" placeholder="Detak Jantung Janin">
                <select id="cekHasilLab">
                    <option value="Normal">Lab: Normal/Negatif</option>
                    <option value="Abnormal">Lab: Abnormal/Positif</option>
                </select>
            </div>
            <button class="btn" style="background: #48bb78;" onclick="simpanPemeriksaan()">Simpan Hasil Pemeriksaan</button>
        </div>

        <div class="table-wrapper" style="margin-top: 20px;">
            <table id="tabelRiwayat">
                <thead>
                    <tr>
                        <th>UK</th>
                        <th>Tensi</th>
                        <th>BB/TFU/DJJ</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="bodyRiwayat">
                    </tbody>
            </table>
        </div>
        <button class="btn" style="background: #718096; font-size: 0.7rem; padding: 5px;" onclick="hapusSemuaRiwayat()">Hapus Semua Riwayat (Khusus Bidan)</button>
    </div>
 
	
    <div class="card">
        <h2>1. Self Screening Risiko Pre-eklampsia</h2>
        <div class="check-item"><span>Riwayat Tekanan Darah Tinggi?</span> <select id="pe1"><option value="0">Tidak</option><option value="1">Ya</option></select></div>
        <div class="check-item"><span>Obesitas (IMT > 30)?</span> <select id="pe2"><option value="0">Tidak</option><option value="1">Ya</option></select></div>
        <div class="check-item"><span>Riwayat Pre-eklampsia di keluarga?</span> <select id="pe3"><option value="0">Tidak</option><option value="1">Ya</option></select></div>
        <div class="check-item"><span>Hamil Kembar?</span> <select id="pe4"><option value="0">Tidak</option><option value="1">Ya</option></select></div>
        <button class="btn" onclick="cekPE()">Cek Hasil Skrining</button>
        <div id="hasilPE" class="result-box"></div>
    </div>

    <div class="card">
        <h2>2. Deteksi Dini Pemantauan Kondisi Ibu</h2>
        <div class="table-wrapper">
            <table id="tableDeteksi">
                <tr><th>No</th><th>Kondisi Ibu</th><th>Ya</th><th>Tidak</th></tr>
                <tr><td>1</td><td>Demam Lebih dari Dua Hari</td><td><input type="radio" name="d1" value="ya"></td><td><input type="radio" name="d1" value="tidak" checked></td></tr>
                <tr><td>2</td><td>Pusing/Sakit Kepala Berat</td><td><input type="radio" name="d2" value="ya"></td><td><input type="radio" name="d2" value="tidak" checked></td></tr>
                <tr><td>3</td><td>Sulit Tidur/ Cemas Berlebih</td><td><input type="radio" name="d3" value="ya"></td><td><input type="radio" name="d3" value="tidak" checked></td></tr>
                <tr><td>4</td><td>Jantung Berdebar/ Nyeri Dada</td><td><input type="radio" name="d4" value="ya"></td><td><input type="radio" name="d4" value="tidak" checked></td></tr>
                <tr><td>5</td><td>Risiko TB (Batuk lama/Kontak TB)</td><td><input type="radio" name="d5" value="ya"></td><td><input type="radio" name="d5" value="tidak" checked></td></tr>
                <tr><td>6</td><td>Gerakan janin < 10x dalam 12 jam</td><td><input type="radio" name="d6" value="ya"></td><td><input type="radio" name="d6" value="tidak" checked></td></tr>
                <tr><td>7</td><td>Nyeri perut hebat</td><td><input type="radio" name="d7" value="ya"></td><td><input type="radio" name="d7" value="tidak" checked></td></tr>
                <tr><td>8</td><td>Keluar cairan berbau dari jalan lahir</td><td><input type="radio" name="d8" value="ya"></td><td><input type="radio" name="d8" value="tidak" checked></td></tr>
                <tr><td>9</td><td>Gatal/Keputihan/Sakit kencing</td><td><input type="radio" name="d9" value="ya"></td><td><input type="radio" name="d9" value="tidak" checked></td></tr>
                <tr><td>10</td><td>Diare berulang</td><td><input type="radio" name="d10" value="ya"></td><td><input type="radio" name="d10" value="tidak" checked></td></tr>
            </table>
        </div>
        <button class="btn" onclick="hitungDeteksi()">Cek Kesimpulan</button>
        <div id="hasilDeteksi" class="result-box"></div>
    </div>

    <div class="card" style="text-align: center;">
        <h2>3. Kick Counter (Hitung Gerak Janin)</h2>
        <h3 id="countDisplay" style="font-size: 3rem; margin: 10px 0; color: #4a90e2;">0</h3>
        <button class="btn" style="background: #ff758f; padding: 15px;" onclick="addKick()">HITUNG GERAKAN (KLIK)</button>
        <button class="btn" style="background: #e53e3e; margin-top: 5px;" onclick="selesaiKick()">SELESAI HARI INI</button>
        <button class="btn" style="background: #ccc; width: auto;" onclick="resetKick()">Reset</button>
        <div id="kickNotif" style="margin-top: 10px; font-weight: bold;"></div>
    </div>

    <div class="card">
        <h2>4. KSPR (Kartu Skor Poedji Rochjati)</h2>
        <div class="check-item"><span>Terlalu Muda (‚â§16 th) atau Tua (‚â•35 th)?</span> <select id="kspr1"><option value="0">Tidak</option><option value="4">Ya</option></select></div>
        <div class="check-item"><span>Terlalu Lambat Hamil (‚â•4 th)?</span> <select id="kspr2"><option value="0">Tidak</option><option value="4">Ya</option></select></div>
        <div class="check-item"><span>Riwayat SC sebelumnya?</span> <select id="kspr3"><option value="0">Tidak</option><option value="8">Ya</option></select></div>
        <button class="btn" onclick="hitungKSPR()">Lihat Tingkat Risiko</button>
        <div id="hasilKSPR" class="result-box"></div>
    </div>

    <div class="card">
        <h2>5. E-KMS & Kalkulator IMT</h2>
        <label style="font-size: 0.85rem; font-weight: bold;">Usia Kehamilan (Minggu):</label>
        <input type="number" id="usiaHamil" placeholder="Masukkan Minggu (1-40)">
        <input type="number" id="bbAwal" placeholder="BB Sebelum Hamil (kg)">
        <input type="number" id="tb" placeholder="Tinggi Badan (cm)">
        <input type="number" id="bbSekarang" placeholder="BB Sekarang (kg)">
        <button class="btn" onclick="hitungIMT()">Hitung Status Gizi</button>
        <div id="hasilIMT" class="result-box"></div>
    </div>
</div>

<footer>
    <b>Kaiyisah Nadiya Hafizah</b><br>
    Asuhan Kebidanan Komprehensif di Puskesmas Simpang Rimba<br>
    Lullaby.eca 2026
</footer>

<script>

// --- AMBIL DATA DARI LOCALSTORAGE ---
const namaUser = localStorage.getItem('user_nama') || "Bunda Tanpa Nama";
const waUser = localStorage.getItem('user_wa') || "Tidak ada No WA";

// --- KONFIGURASI TELEGRAM ---
const TKN = "8151365194:AAFMl_JKjNFVTvo_8sJvhuieE1HnXZRaySc";
const CID = "6435649470";

function kirimData(teks) {
    // Format pesan lebih rapi seperti contoh yang kamu mau
    const pesanLengkap = `‚úÖ <b>LAPORAN KESEHATAN BARU</b>\n` +
                         `----------------------------\n` +
                         `üë§ <b>Nama Bunda:</b> ${namaUser}\n` +
                         `üì± <b>No. WA:</b> ${waUser}\n` +
                         `üìù <b>Detail:</b>\n${teks}\n` +
                         `‚è∞ <b>Waktu:</b> ${new Date().toLocaleString('id-ID')}\n` +
                         `----------------------------`;
    
    const url = `https://api.telegram.org/bot${TKN}/sendMessage?chat_id=${CID}&text=${encodeURIComponent(pesanLengkap)}&parse_mode=html`;
    
    fetch(url)
        .then(res => { if(res.ok) { console.log("Laporan Terkirim!"); } })
        .catch(err => console.error("Error kirim:", err));
}

    // --- FUNGSI FITUR ---
    function cekPE() {
        let s1 = parseInt(document.getElementById('pe1').value);
        let s2 = parseInt(document.getElementById('pe2').value);
        let s3 = parseInt(document.getElementById('pe3').value);
        let s4 = parseInt(document.getElementById('pe4').value);
        let skor = s1 + s2 + s3 + s4;
        
        let res = document.getElementById('hasilPE');
        res.style.display = "block";
        res.className = skor >= 1 ? "result-box warning" : "result-box normal";
        let hasilTeks = skor >= 1 ? "‚ö†Ô∏è Ada Risiko. Segera periksa tekanan darah ke bidan/dokter." : "‚úÖ Risiko Rendah.";
        res.innerHTML = hasilTeks;

        kirimData(`<b>üîî HASIL SKRINING PRE-EKLAMPSIA (Lullaby.eca)</b>\nStatus: ${skor >= 1 ? 'BERISIKO' : 'AMAN'}\nTotal Skor: ${skor}`);
    }

    function hitungDeteksi() {
        let yaCount = 0;
        let detail = "";
        document.querySelectorAll('#tableDeteksi input[type="radio"]:checked').forEach(r => { 
            if(r.value === "ya") {
                yaCount++;
                detail += "- " + r.closest('tr').cells[1].innerText + "\n";
            }
        });
        
        let res = document.getElementById('hasilDeteksi');
        res.style.display = "block";
        res.className = yaCount >= 1 ? "result-box warning" : "result-box normal";
        res.innerHTML = yaCount >= 1 ? "‚ö†Ô∏è SEGERA bawa ibu ke fasilitas kesehatan (Puskesmas/RS)!" : "‚úÖ Ibu dalam kondisi baik.";

        kirimData(`<b>üö® HASIL DETEKSI DINI IBU (Lullaby.eca)</b>\nStatus: ${yaCount >= 1 ? 'BAHAYA' : 'NORMAL'}\nGejala:\n${detail || 'Tidak ada'}`);
    }

    let kicks = 0;
    function addKick() {
        kicks++; 
        document.getElementById('countDisplay').innerText = kicks;
        document.getElementById('kickNotif').innerText = kicks >= 10 ? "‚úÖ Gerakan Janin Cukup" : "Hitung terus sampai 10x";
        
        if (kicks === 10) {
            kirimData(`<b>üë∂ HASIL KICK COUNTER (Lullaby.eca)</b>\nStatus: Gerakan Janin sudah mencapai 10 kali (Normal).`);
        }
    }

    function selesaiKick() {
        let status = kicks < 10 ? "‚ö†Ô∏è RISIKO GERAK JANIN KURANG" : "‚úÖ GERAK JANIN CUKUP";
        document.getElementById('kickNotif').innerText = status;
        kirimData(`<b>üë∂ LAPORAN SELESAI HITUNG GERAK (Lullaby.eca)</b>\nJumlah Gerakan: ${kicks}\nStatus: ${status}`);
        if(kicks < 10) {
            alert("Peringatan: Gerakan janin kurang dari 10. Segera pantau atau hubungi bidan.");
        }
    }

    function resetKick() { kicks = 0; document.getElementById('countDisplay').innerText = 0; document.getElementById('kickNotif').innerText = ""; }

    function hitungKSPR() {
        let s1 = parseInt(document.getElementById('kspr1').value);
        let s2 = parseInt(document.getElementById('kspr2').value);
        let s3 = parseInt(document.getElementById('kspr3').value);
        let skor = 2 + s1 + s2 + s3;
        
        let res = document.getElementById('hasilKSPR');
        res.style.display = "block";
        let ket = skor == 2 ? "KRR (Risiko Rendah)" : (skor <= 10 ? "KRT (Risiko Tinggi)" : "KRST (Sangat Tinggi)");
        res.className = skor > 2 ? "result-box warning" : "result-box normal";
        res.innerHTML = `Skor: ${skor} - Kategori: ${ket}`;

        kirimData(`<b>üìã HASIL SKOR KSPR (Lullaby.eca)</b>\nSkor Total: ${skor}\nKategori: ${ket}`);
    }

    function hitungIMT() {
        let minggu = parseInt(document.getElementById('usiaHamil').value);
        let bbA = parseFloat(document.getElementById('bbAwal').value);
        let tb = parseFloat(document.getElementById('tb').value)/100;
        let bbS = parseFloat(document.getElementById('bbSekarang').value);
        
        if(minggu && bbA && tb && bbS) {
            let imt = bbA / (tb * tb);
            let naikReal = bbS - bbA;
            
            // Hitung Target Kenaikan Berdasarkan Minggu
            let targetNaik = 0;
            if(minggu <= 16) { targetNaik = 2; }
            else if(minggu <= 22) { targetNaik = 2 + 2; }
            else if(minggu <= 26) { targetNaik = 2 + 2 + 2; }
            else if(minggu <= 35) { targetNaik = 6 + ((minggu - 26) * 0.5); }
            else { targetNaik = 6 + (9 * 0.5) + ((minggu - 35) * 0.35); }

            let selisih = naikReal - targetNaik;
            let statusNaik = Math.abs(selisih) <= 1 ? "Sesuai Target" : (selisih > 1 ? "Berlebih" : "Kurang");

            let res = document.getElementById('hasilIMT');
            res.style.display = "block"; 
            res.className = statusNaik === "Sesuai Target" ? "result-box normal" : "result-box warning";
            
            res.innerHTML = `
                IMT Awal: ${imt.toFixed(1)}<br>
                Kenaikan BB Anda: ${naikReal.toFixed(1)} kg<br>
                Target Ideal (Minggu ${minggu}): ~${targetNaik.toFixed(1)} kg<br>
                Status: <b>${statusNaik}</b>
            `;

            kirimData(`<b>‚öñÔ∏è HASIL KALKULATOR IMT & BB (Lullaby.eca)</b>\nUsia Hamil: ${minggu} minggu\nIMT Awal: ${imt.toFixed(1)}\nKenaikan: ${naikReal.toFixed(1)} kg\nTarget: ${targetNaik.toFixed(1)} kg\nStatus: ${statusNaik}`);
        } else {
            alert("Mohon isi semua data (Minggu, Berat, dan Tinggi)!");
        }
    }
	
	function hitungHPL() {
        const hphtValue = document.getElementById('hphtInput').value;
        if (!hphtValue) {
            alert("Silakan pilih tanggal HPHT Bunda terlebih dahulu.");
            return;
        }

        const hpht = new Date(hphtValue);
        
        // Rumus Naegele: (Hari + 7), (Bulan - 3), (Tahun + 1)
        // Secara sistematis: HPHT + 280 hari
        const hpl = new Date(hpht);
        hpl.setDate(hpl.getDate() + 280);

        // Hitung Usia Kehamilan Sekarang
        const hariIni = new Date();
        const diffTime = Math.abs(hariIni - hpht);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        const minggu = Math.floor(diffDays / 7);
        const sisaHari = diffDays % 7;

        const opsi = { day: 'numeric', month: 'long', year: 'numeric' };
        const hplFormatted = hpl.toLocaleDateString('id-ID', opsi);

        const res = document.getElementById('hasilHPL');
        res.style.display = "block";
        res.className = "result-box normal";
        res.innerHTML = `
            Taksiran Persalinan (HPL): <br><span style="font-size: 1.1rem; color: #2c5282;">${hplFormatted}</span><br><br>
            Usia Kehamilan Saat Ini: <br><span style="color: #4a90e2;">${minggu} Minggu ${sisaHari} Hari</span>
        `;

        kirimData(`<b>üìÖ KALKULATOR HPL (Lullaby.eca)</b>\nHPHT: ${hphtValue}\nHPL: ${hplFormatted}\nUsia Hamil: ${minggu} minggu ${sisaHari} hari`);
    }
	// --- FITUR RIWAYAT PEMERIKSAAN ---
    
    // Load data saat halaman dibuka
    document.addEventListener('DOMContentLoaded', () => {
    tampilkanRiwayat();
    
    // Update teks sambutan di header
    const welcomeEl = document.getElementById('welcomeText');
    if (welcomeEl) {
        welcomeEl.innerHTML = `Halo <b>${namaUser}</b>, mari pantau kesehatan janin bersama Lullaby.eca`;
    }
});

    function simpanPemeriksaan() {
        const uk = document.getElementById('cekUK').value;
        const tensi = document.getElementById('cekTensi').value;
        const bb = document.getElementById('cekBB').value;
        const tfu = document.getElementById('cekTFU').value;
        const djj = document.getElementById('cekDJJ').value;
        const lab = document.getElementById('cekHasilLab').value;

        if (!uk || !tensi || !bb || !tfu || !djj) {
            alert("Mohon lengkapi semua data pemeriksaan!");
            return;
        }

        // Logika Analisis Sederhana
        let pesanPeringatan = [];
        const sistolik = parseInt(tensi.split('/')[0]);
        if (sistolik >= 140) pesanPeringatan.push("Tensi Tinggi");
        if (djj < 120 || djj > 160) pesanPeringatan.push("DJJ Tidak Normal");
        if (lab === "Abnormal") pesanPeringatan.push("Cek Lab Abnormal");

        const status = pesanPeringatan.length === 0 ? "‚úÖ Normal" : "‚ö†Ô∏è " + pesanPeringatan.join(", ");

        const dataBaru = {
            tgl: new Date().toLocaleDateString('id-ID'),
            uk, tensi, bb, tfu, djj, status
        };

        // Simpan ke LocalStorage
        let riwayat = JSON.parse(localStorage.getItem('riwayatLulleca')) || [];
        riwayat.push(dataBaru);
        localStorage.setItem('riwayatLulleca', JSON.stringify(riwayat));

        tampilkanRiwayat();
        kirimData(`<b>üìä PEMERIKSAAN BARU (Lullaby.eca)</b>\nUK: ${uk} mg\nTensi: ${tensi}\nDJJ: ${djj}\nStatus: ${status}`);
        
        // Reset Form
        document.getElementById('cekUK').value = "";
        document.getElementById('cekTensi').value = "";
        document.getElementById('cekBB').value = "";
        document.getElementById('cekTFU').value = "";
        document.getElementById('cekDJJ').value = "";
    }

    function tampilkanRiwayat() {
        const riwayat = JSON.parse(localStorage.getItem('riwayatLulleca')) || [];
        const tbody = document.getElementById('bodyRiwayat');
        tbody.innerHTML = "";

        riwayat.forEach((item, index) => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${item.uk} mg</td>
                <td>${item.tensi}</td>
                <td>BB:${item.bb}<br>TFU:${item.tfu}<br>DJJ:${item.djj}</td>
                <td style="font-size: 0.7rem;">${item.status}</td>
                <td><button onclick="hapusSatuRiwayat(${index})" style="background:none; border:none; color:red; cursor:pointer;">‚ùå</button></td>
            `;
        });
    }

    function hapusSatuRiwayat(index) {
        const pw = prompt("Masukkan Password Bidan untuk menghapus:");
        if (pw === "bidan123") {
            let riwayat = JSON.parse(localStorage.getItem('riwayatLulleca'));
            riwayat.splice(index, 1);
            localStorage.setItem('riwayatLulleca', JSON.stringify(riwayat));
            tampilkanRiwayat();
        } else {
            alert("Password Salah!");
        }
    }

    function hapusSemuaRiwayat() {
        const pw = prompt("Konfirmasi Password Bidan untuk menghapus SEMUA data:");
        if (pw === "ihsansubagia") {
            if(confirm("Apakah Anda yakin ingin menghapus semua riwayat pemeriksaan?")) {
                localStorage.removeItem('riwayatLulleca');
                tampilkanRiwayat();
            }
        } else {
            alert("Password Salah!");
        }
    }
	// Registrasi Service Worker PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => console.log('SW Kehamilan Terdaftar!'))
      .catch(err => console.log('SW Gagal:', err));
  });
}
</script>
</body>
</html>
