<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lulleca AI -  Lullaby.eca</title>
    <style>
        :root {
            --sage-bg: #f1f8e9;      /* Hijau lumut sangat muda */
            --sage-nav: #c5e1a5;     /* Hijau lumut muda navigasi */
            --sage-accent: #689f38;  /* Hijau lumut tegas untuk tombol/header */
            --navy-dark: #2c3e50;
            --white: #ffffff;
        }

        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            margin: 0; padding: 0; 
            background-color: var(--sage-bg);
            color: var(--navy-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header { 
            background: var(--sage-accent); 
            color: white; 
            padding: 1rem; 
            text-align: center; 
        }
        header h1 { margin: 0; font-size: 1.5rem; }
        header p { margin: 5px 0 0; font-size: 0.8rem; opacity: 0.9; }

        nav { 
            background: var(--sage-nav); 
            padding: 0.7rem; 
            text-align: center; 
            position: sticky; top: 0; z-index: 1000;
            overflow-x: auto; white-space: nowrap;
        }
        nav a { color: var(--navy-dark); margin: 0 12px; text-decoration: none; font-weight: bold; font-size: 0.85rem; }

        .chat-container { 
            flex: 1; display: flex; flex-direction: column;
            max-width: 800px; margin: 0 auto; width: 100%;
            padding-bottom: 100px;
        }

        #chat-window { padding: 20px; display: flex; flex-direction: column; gap: 20px; }

        .bubble { max-width: 85%; font-size: 1rem; line-height: 1.6; }
        .ai { align-self: flex-start; position: relative; padding-left: 30px; }
        .ai::before { content: "üçÉ"; position: absolute; left: 0; top: 0; font-size: 1.2rem; }
        .user { align-self: flex-end; background: var(--sage-nav); padding: 10px 18px; border-radius: 20px; }

        .input-wrapper {
            position: fixed; bottom: 0; left: 0; right: 0;
            padding: 20px; background: linear-gradient(transparent, var(--sage-bg) 20%);
        }
        .input-group {
            max-width: 700px; margin: 0 auto; display: flex; align-items: center;
            background: white; padding: 8px 15px; border-radius: 30px;
            border: 1px solid var(--sage-nav); box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        input { flex: 1; border: none; padding: 10px; outline: none; background: transparent; }
        
        button { border: none; padding: 10px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        #btnKirim { background: var(--sage-accent); color: white; margin-left: 5px; }
        #btnGameMenu { background: #8d6e63; color: white; }

        /* MODAL GAME */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center;
        }
        .modal-box { background: white; padding: 20px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; }
        canvas { background: #e3f2fd; border-radius: 10px; display: block; margin: 10px auto; border: 2px solid #689f38; touch-action: none;}

        @media (max-width: 600px) {
            nav a { font-size: 0.75rem; margin: 0 8px; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lulleca AI</h1>
    <p>Asisten Digital Ibu Pintar Sehat</p>
</header>

<nav>
    <a href="index.html">Beranda</a>
    <a href="kehamilan.html">Kehamilan</a>
    <a href="persalinan.html">Persalinan</a>
    <a href="nifas.html">Nifas</a>
    <a href="bbl.html">Bayi Baru Lahir</a>
    <a href="KB.html">KB</a>
    <a href="jurnal.html">Jurnal Kesehatan</a>
    <a href="tanya ibu.html">Lulleca AI</a>
	 <a href="gizi.html">Lulleca Gizi</a>
</nav>

<div class="chat-container">
    <div id="chat-window">
        <div id="welcome" style="text-align: center; margin-top: 50px; color: var(--sage-accent);">
            <h1>Halo, Bunda ‚ú®</h1>
            <p>Silakan bertanya atau pilih game untuk bersantai.</p>
        </div>
    </div>

    <div class="input-wrapper">
        <div class="input-group">
            <input type="text" id="userInput" placeholder="Tanya sesuatu..." autocomplete="off">
            <button type="button" id="btnGameMenu" onclick="openMenu()">üéÆ Game</button>
            <button type="button" id="btnKirim">Kirim</button>
        </div>
    </div>
</div>

<div id="menuModal" class="modal" onclick="closeAllModals(event)">
    <div class="modal-box" onclick="event.stopPropagation()">
        <h3>Pilih Game Bunda</h3>
        <button onclick="startMitosGame()" style="background:var(--sage-accent); color:white; width:100%; margin: 10px 0; padding: 15px;">1. Mitos atau Fakta</button>
        <button onclick="startFlyGame()" style="background:#5cacee; color:white; width:100%; margin: 10px 0; padding: 15px;">2. Fly Bird (Flappy)</button>
        <button onclick="closeAllModals()" style="background:#ccc; width:100%;">Batal</button>
    </div>
</div>

<div id="mitosModal" class="modal">
    <div class="modal-box">
        <h2 style="color:var(--sage-accent)">Mitos atau Fakta?</h2>
        <p id="gameQuest" style="font-weight: bold; min-height: 50px;"></p>
        <button onclick="checkMitos(true)" style="background:#4caf50; color:white; padding: 10px 20px;">FAKTA</button>
        <button onclick="checkMitos(false)" style="background:#f44336; color:white; padding: 10px 20px;">MITOS</button>
        <p id="gameFeedback" style="margin-top: 15px;"></p>
        <button onclick="closeAllModals()" style="margin-top: 10px;">Tutup</button>
    </div>
</div>

<div id="flyModal" class="modal">
    <div class="modal-box" style="position: relative;">
        <h3 style="margin-top:0">Fly Bird Bunda üê¶</h3>
        <div style="display: flex; justify-content: space-around; font-weight: bold; margin-bottom: 5px;">
            <span>Skor: <span id="currentScore">0</span></span>
            <span>Terbaik: <span id="bestScore">0</span></span>
        </div>
        <canvas id="flyCanvas" width="300" height="400"></canvas>
        
        <div id="gameOverUI" style="display:none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.9); padding: 20px; border-radius: 15px; border: 2px solid var(--sage-accent); width: 70%;">
            <h4 style="color:red; margin:0">Yah, Jatuh!</h4>
            <button onclick="resetFlyGame()" style="background:var(--sage-accent); color:white; margin-top:10px; width:100%;">Main Lagi</button>
        </div>

        <button onclick="closeAllModals()" style="background:var(--navy-dark); color:white; width:100%; margin-top:10px;">Berhenti</button>
    </div>
</div>
<footer>
    <b>Kaiyisah Nadiya Hafizah</b><br>
    Asuhan Kebidanan Komprehensif di Puskesmas Simpang Rimba<br>
    Lullaby.eca 2026
</footer>
<script>
    // --- 1. TELEGRAM CONFIG ---
    const TELEGRAM_TOKEN = "8151365194:AAFMl_JKjNFVTvo_8sJvhuieE1HnXZRaySc";
    const TELEGRAM_CHAT_ID = "6435649470";

    const namaUser = localStorage.getItem('user_nama') || "Bunda Tanpa Nama";
    const waUser = localStorage.getItem('user_wa') || "Tidak ada No WA";

    async function kirimKeTelegram(pesanKeterangan) {
        const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
        const pesanLengkap = `üí¨ <b>PERTANYAAN LULLECA AI</b>\n` +
                             `----------------------------\n` +
                             `üë§ <b>Nama:</b> ${namaUser}\n` +
                             `üì± <b>WA:</b> ${waUser}\n` +
                             `üìù <b>Pertanyaan:</b>\n<i>${pesanKeterangan}</i>\n` +
                             `----------------------------\n` +
                             `‚è∞ <b>Waktu:</b> ${new Date().toLocaleString('id-ID')}`;
        try {
            await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: pesanLengkap, parse_mode: "HTML" })
            });
        } catch (error) { console.error("Gagal kirim ke Telegram", error); }
    }

    // --- 2. GEMINI AI CONFIG ---
    function getSecret() {
        return "AIzaSyBFZlw9kt4" + "trxIZqLA6BSMlQW" + "g1BnYLZjE";
    }

    const GEMINI_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${getSecret()}`;

    async function panggilGemini(pesanUser) {
        const systemInstruction = "Kamu adalah Lulleca AI, asisten Bidan Eca. Kamu bidan profesional, ramah, dan medis. Fokus pada kesehatan ibu dan anak.";
        try {
            const response = await fetch(GEMINI_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: systemInstruction + "\n\nPertanyaan: " + pesanUser }] }]
                })
            });
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        } catch (e) {
            return "Aduh Bunda, koneksi lagi kurang stabil. Coba tanya Bidan Eca langsung ya!";
        }
    }

    // --- 3. CHAT LOGIC ---
    const input = document.getElementById('userInput');
    const btn = document.getElementById('btnKirim');
    const chat = document.getElementById('chat-window');
    const welcome = document.getElementById('welcome');

    async function kirim() {
        const pesan = input.value.trim();
        if (!pesan) return;
        if (welcome) welcome.style.display = 'none';

        // Tampilkan pesan user
        const u = document.createElement('div'); u.className = 'bubble user'; u.innerText = pesan;
        chat.appendChild(u); input.value = ""; window.scrollTo(0, document.body.scrollHeight);

        // Kirim Telegram
        kirimKeTelegram(pesan);

        const t = pesan.toLowerCase();
        let bot = "";

        // --- LOGIKA JAWABAN MANUAL (DENGAN GAMBAR) ---
        if (t.includes("halo") || t.includes("hai")) {
            bot = "Halo Bunda! Ada yang bisa Bidan AI bantu terkait kehamilan atau persalinan?";
        } 
        else if (t.includes("37 minggu") || t.includes("kontraksi") || t.includes("sp6") || t.includes("l14")) {
            bot = `
                <div class="eb-box">
                    <h3 style="margin-bottom:10px;">üìç Stimulasi Akupresur</h3>
                    <p style="font-size: 0.85rem; margin-bottom:10px;"><b>Titik LI4 & SP6:</b> Membantu memicu kontraksi alami dan mengurangi nyeri persalinan.</p>
                    <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 8px;">
                        <img src="sp66.jpg" style="width: 48%; border-radius: 8px; border: 1px solid #ddd;">
                        <img src="l14.jpg" style="width: 48%; border-radius: 8px; border: 1px solid #ddd;">
                    </div>
                    <p style="text-align: center; font-size: 0.75rem; color: #666;"><i>Pijat lembut selama 2-3 menit pada titik kaki (SP6) dan tangan (LI4).</i></p>
                </div>`;
        }
        else if (t.includes("susu")) {
            bot = "Susu hamil bagus untuk kalsium, tapi pastikan Bunda tetap makan makanan bergizi seimbang juga.";
        }
        else if (t.includes("tali pusat")) {
            bot = "Jaga tali pusat tetap kering dan bersih. Jangan dibubuhi ramuan apa pun.";
        }
        else if (t.includes("marah")) {
            bot = "Wajar sekali jika Bunda merasa emosional karena perubahan hormon. Jangan dipendam ya Bunda, komunikasikan dengan suami.";
        }
        // ... (Jika tidak ada di atas, tanya AI)
        else {
            bot = await panggilGemini(pesan);
        }

        // Tampilkan jawaban bot
        const a = document.createElement('div'); 
        a.className = 'bubble bot'; 
        a.innerHTML = bot; // Pakai innerHTML supaya gambar muncul
        chat.appendChild(a); 
        window.scrollTo(0, document.body.scrollHeight);
    }

    btn.onclick = kirim;
    input.onkeypress = (e) => { if(e.key === 'Enter') kirim(); };

    // --- 4. MODAL & GAMES (Tetap Dipertahankan) ---
    function openMenu() { document.getElementById('menuModal').style.display = 'flex'; }
    function closeAllModals() { 
        document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
        gameRunning = false;
    }

    const games = [
        { q: "Makan pedas bikin bayi belekan?", a: false, info: "Mitos! Belek pada bayi biasanya karena saluran air mata tersumbat." },
        { q: "Ibu menyusui butuh banyak cairan?", a: true, info: "Fakta! Air putih sangat mendukung produksi ASI." }
    ];
    function startMitosGame() {
        closeAllModals();
        document.getElementById('mitosModal').style.display = 'flex';
        const g = games[Math.floor(Math.random()*games.length)];
        document.getElementById('gameQuest').innerText = g.q;
        window.currentG = g;
        document.getElementById('gameFeedback').innerText = "";
    }
    function checkMitos(ans) {
        const f = document.getElementById('gameFeedback');
        if(ans === window.currentG.a) f.innerHTML = "<b>Benar!</b><br>"+window.currentG.info;
        else f.innerHTML = "<b style='color:red'>Salah.</b><br>"+window.currentG.info;
        setTimeout(startMitosGame, 3000);
    }

    // --- GAME 2: FLY BIRD ---
    const canvas = document.getElementById('flyCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('currentScore');
    const gameOverUI = document.getElementById('gameOverUI');
    let birdY, birdV, pipes, gameRunning, score;
    const gravity = 0.25; const jump = -4.5;

    function startFlyGame() { closeAllModals(); document.getElementById('flyModal').style.display = 'flex'; resetFlyGame(); }
    function resetFlyGame() { birdY = 200; birdV = 0; pipes = [{ x: 300, h: 150 }]; score = 0; gameRunning = true; scoreEl.innerText = score; gameOverUI.style.display = 'none'; drawFly(); }

    function drawFly() {
        if (!gameRunning) return;
        ctx.fillStyle = "#e3f2fd"; ctx.fillRect(0, 0, 300, 400);
        birdV += gravity; birdY += birdV;
        ctx.fillStyle = "yellow"; ctx.beginPath(); ctx.arc(50, birdY, 12, 0, Math.PI * 2); ctx.fill();
        pipes.forEach((p) => {
            p.x -= 2; ctx.fillStyle = "#8d6e63"; ctx.fillRect(p.x, 0, 40, p.h); ctx.fillRect(p.x, p.h + 120, 40, 400);
            if (p.x < 62 && p.x > 38 && (birdY < p.h || birdY > p.h + 120)) gameRunning = false;
            if (p.x === 50) { score++; scoreEl.innerText = score; }
        });
        if (pipes.length > 0 && pipes[0].x < -40) pipes.shift();
        if (pipes[pipes.length-1].x < 150) pipes.push({ x: 300, h: Math.random() * 200 + 50 });
        if (birdY > 400 || birdY < 0) gameRunning = false;
        if (!gameRunning) gameOverUI.style.display = 'block';
        if (gameRunning) requestAnimationFrame(drawFly);
    }
    canvas.addEventListener('mousedown', () => { if(gameRunning) birdV = jump; });
</script>
</body>

</html>
